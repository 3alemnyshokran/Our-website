<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutoring Website - English & Math</title>  
  <link rel="stylesheet" href="assets/css/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <!-- Add Google Font - Poppins and Fira Code -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  <!-- Load Auth JS -->
  <script src="assets/js/auth.js"></script>
  <!-- Load Cookie Consent -->
  <script src="assets/js/cookie-consent.js"></script>
  <!-- Load DB Connectivity Checker -->
  <script src="assets/js/db-connectivity.js" defer></script>
  <!-- Add Auth Protection -->
  <script src="assets/js/auth-protection.js"></script>
</head>
<body>
  <audio id="clickSound" src="assets/audio/click.mp3" preload="auto"></audio>

  <!-- Header Controls -->
  <div class="header-controls">
    <button class="theme-btn" aria-label="Toggle Theme" onclick="toggleTheme()">
      <i class="fas fa-sun light-icon"></i>
      <i class="fas fa-moon dark-icon"></i>
    </button>
    <select id="languageSelect" aria-label="Select Language">
      <option value="en">English</option>
      <option value="ar">العربية</option>
      <option value="de">Deutsch</option>
      <option value="es">Español</option>
      <option value="fr">Français</option>
    </select>
    <button id="logoutBtn" class="logout-btn" onclick="logout()" style="display: none;">Logout <i class="fas fa-sign-out-alt"></i></button>
  </div>

  <div class="main-container">
    <div class="main-content-area">
      <h1 data-i18n="welcome">Welcome to the Tutoring Website</h1>
      <p data-i18n="helloUser">Hello, <span id="welcomeUser"></span>!</p>
      <p data-i18n="coursesInfo">Courses for English and Math - Beginner, Intermediate, Advanced Levels</p>
      
      <!-- Course navigation -->
      <div class="btn-container">
        <a href="pages/courses/english/english-course.html" class="btn" data-i18n="englishCourses"><i class="fas fa-language"></i> English Courses</a>
        <a href="pages/courses/math/math-course.html" class="btn" data-i18n="mathCourses"><i class="fas fa-calculator"></i> Math Courses</a>
        <a href="pages/courses/science/science-course.html" class="btn" data-i18n="scienceCourses"><i class="fas fa-flask"></i> Science Courses</a>
        <a href="pages/courses/german/german-course.html" class="btn" data-i18n="germanCourses"><i class="fas fa-language"></i> German Courses</a>
        <a href="pages/courses/arabic/arabic-course.html" class="btn" data-i18n="arabicCourses"><i class="fas fa-language"></i> Arabic Courses</a>
      </div>
    </div>

    <div id="courseContainer" class="main-content-area" style="margin-top: 2rem;">
      <!-- Course content will be loaded here -->
    </div>
  </div>

  <script src="assets/js/main.js"></script>
  <script>
    // Check if the user is authenticated
    document.addEventListener('DOMContentLoaded', function() {
      // If not authenticated, redirect to login page
      if (!isAuthenticated()) {
        localStorage.setItem('redirect_after_login', window.location.pathname + window.location.search);
        window.location.href = 'pages/auth/login.html';
        return;
      }
      
      // If authenticated but privacy not accepted, show privacy policy
      if (!isPrivacyAccepted()) {
        showPrivacyModal().then(() => {
          initializePage();
        }).catch(() => {
          // Handle case where user might close modal without accepting (if applicable)
          logout(); // Or redirect to a page explaining why consent is needed
        });
      } else {
        initializePage();
      }
    });
    
    function initializePage() {
      // Initialize the page with the user's data
      const username = getCurrentUsername();
      const welcomeUserElement = document.getElementById('welcomeUser');
      if (welcomeUserElement) {
        welcomeUserElement.textContent = username || 'Guest';
      }
      
      // Show logout button
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) {
        logoutBtn.style.display = 'inline-flex';
      }

      // Initialize theme (from main.js or here if main.js doesn't handle it early enough)
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.body.setAttribute('data-theme', savedTheme);
      updateThemeIcon(savedTheme);
      
      // Initialize language (from main.js or here)
      const savedLanguage = localStorage.getItem('language') || 'en';
      const langSelect = document.getElementById('languageSelect');
      if (langSelect) langSelect.value = savedLanguage;
      // Assuming changeLanguage function is available globally or from main.js
      if (typeof changeLanguage === 'function') {
        changeLanguage(savedLanguage);
      } else {
        console.warn('changeLanguage function not found. Language features might not work.');
      }
    }

    function updateThemeIcon(theme) {
        const lightIcon = document.querySelector('.theme-btn .light-icon');
        const darkIcon = document.querySelector('.theme-btn .dark-icon');
        if (lightIcon && darkIcon) {
            if (theme === 'dark') {
                lightIcon.style.display = 'none';
                darkIcon.style.display = 'inline-block';
            } else {
                lightIcon.style.display = 'inline-block';
                darkIcon.style.display = 'none';
            }
        }
    }

    // Theme toggle function (if not in main.js or needs specific handling here)
    function toggleTheme() {
      const currentTheme = document.body.getAttribute('data-theme') || 'light';
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      document.body.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateThemeIcon(newTheme);
    }
    
    // Language change handler
    const langSelect = document.getElementById('languageSelect');
    if (langSelect) {
        langSelect.addEventListener('change', function() {
            if (typeof changeLanguage === 'function') {
                changeLanguage(this.value);
            } else {
                console.warn('changeLanguage function not found during event listener setup.');
            }
        });
    }
  </script>
</body>
</html>